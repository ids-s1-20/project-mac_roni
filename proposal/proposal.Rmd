---
title: "Project proposal"
author: "macRoni"
output: github_document
---

```{r load-packages, message = FALSE}
library(tidyverse)
library(broom)
library(readr)
library(skimr)
```

## 1. Introduction
The dataset is a Skytrax User Reviews Dataset (published August 2nd, 2015) at https://github.com/quankiquanki/skytrax-reviews-dataset .  


General Theme: Which amenities impact the airline rating the most?

## 2. Data

```{r read-files, message = FALSE }
airline <- read_csv("/cloud/project/data/airline.csv")
airport <- read_csv("/cloud/project/data/airport.csv")
lounge <- read_csv("/cloud/project/data/lounge.csv")
seat <- read_csv("/cloud/project/data/seat.csv")
```

```{r}
glimpse(airline)
glimpse(airport)
glimpse(lounge)
glimpse(seat)
```

## 3. Data analysis plan

We first began by exploring the overall average ratings of the different airlines. 

```{r}
airline %>%
  group_by(airline_name) %>%
  summarise( average_overall_rating = mean(overall_rating, na.rm = TRUE)) %>%
  arrange(desc(average_overall_rating))

```

Next, we visualised the distribution of the traveller types the airline attracts.
Although, this visualization doesn't take into account the 31018 missing values. 

```{r}
airline %>%
  filter(type_traveller != "NA") %>%
  ggplot( mapping = aes( y = type_traveller)) +
  geom_bar() +
  labs( title = "Distribution of the traveller types", 
        y = "Traveller types" 
        ) +
  theme_minimal()
```


1. How does the overall ratings for airlines change depending of the time of year? Do these patterns repeat every year? Which traveller type is prev during which time of the year?

First, all NAs for the response variable and the predictor were removed. 

```{r mean-ratings-airlines, message = FALSE}
airline_nonas <- airline %>%
  drop_na(overall_rating) #removing any NAs
```

Next, we want to investigate how time affects ratings. As the research question focuses on how airlines get high ratings, the five airlines with the highest rating were found. A limit of at least 100 survey submissions was imposed to increase the number of data points.

```{r five-highest-rated-airlines, message = FALSE, echo = FALSE}
airline_nonas %>%
  group_by(airline_name) %>%
  summarise(mean_overall_rating = mean(overall_rating, na.rm = TRUE),
            n = n()) %>%
  filter(n >= 100) %>%
  arrange(desc(mean_overall_rating))
```

These airlines were plotted against time to identify any correlations.

```{r five-highest-ratings-plot, message = FALSE, echo = FALSE}
airline_nonas %>%
  group_by(airline_name, date) %>%
  summarise(mean_overall_rating = mean(overall_rating, na.rm = TRUE)) %>%
  filter(airline_name %in% c("asiana-airlines", "garuda-indonesia", "air-astana", "bangkok-airways", "indigo-airlines"),
         date >= "2014-01-01") %>%
  ggplot(aes(x = date, y = mean_overall_rating, color = airline_name)) +
  geom_smooth(se = FALSE) +
  labs(
    title = "Overall ratings of five highest ranked airlines",
    subtitle = "From 2014 to 2015",
    x = "Date",
    y = "Overall Rating"
  ) +
  guides(color = guide_legend(title = "Airline Name")) 
  
```

As the visualization shows, all of the airlines receive ratings in between 5-10, with air-astana showing an increase at the end of 2015. For indigo-airlines, garuda-indonesia and bangkok-airlines, the ratings deteriorated at the end of 2015. Garuda-indonesia ratings stay constant throughout both years.

There is no clear pattern in each year, which makes sense as the airline companies will normally try to provide the same service throughout the year. 

One can look at the individual ratings (Seat Comfort, Cabin Staff, Food Beverages, Inflight Entertainment and Money Value) and see if there is one rating that sticks out depending on the airline. 

```{r all-airlines-ratings-breakdown, message = FALSE, echo = FALSE}
airline_nonas %>%
  group_by(airline_name, date) %>%
  summarise(mean_seat_comfort_rating = mean(seat_comfort_rating, na.rm = TRUE),
            mean_cabin_staff_rating = mean(cabin_staff_rating, na.rm = TRUE),
            mean_food_beverages_rating = mean(food_beverages_rating, na.rm = TRUE),
            mean_inflight_entertainment_rating = mean(inflight_entertainment_rating, na.rm = TRUE),
            mean_value_money_rating = mean(value_money_rating, na.rm = TRUE),
            ) %>%
  filter(airline_name %in% c("asiana-airlines", "garuda-indonesia", "air-astana", "bangkok-airways", "indigo-airlines"),
         date >= "2014-01-01") %>%
  ggplot(aes(x = date)) +
  geom_smooth(aes(y = mean_seat_comfort_rating, color = "red"), se = FALSE) +
  geom_smooth(aes(y = mean_cabin_staff_rating, color = "green"), se = FALSE) +
  geom_smooth(aes(y = mean_food_beverages_rating, color = "blue"), se = FALSE) +
  geom_smooth(aes(y = mean_inflight_entertainment_rating, color = "yellow"), se = FALSE) +
  geom_smooth(aes(y = mean_value_money_rating, color = "black"), se = FALSE) +
  labs(
    title = "Seat Comfort, Cabin Staff, Food Beverages, Inflight Entertainment and 
Money Value Ratings for Top Five Airlines",
    subtitle = "From 2014 to 2015",
    x = "Date",
    y = "Rating"
  ) +
  scale_color_identity(name = "Type of Rating (Mean)",
                          breaks = c("red", "green", "blue", "yellow", "black"),
                          labels = c("Seat Comfort", "Cabin Staff", "Food Beverages", "Inflight Entertainment", "Money Value"),
                          guide = "legend") +
  facet_wrap(~airline_name, ncol = 3)
  
```
As the visualisation shows, to increase in overall rating, all individaul ratings have to increase. This can be seen in the example of Air Astana. For airlines that decreased in overall rating (bangkok-airways and indigo-airlines), only specific individual ratings decreased or had an overall worse score (especially inflight entertainment). 

2. To what extent do passengers in business class give better overall ratings than passengers in economy/Premium Economy?
Does this alternate between different airplane types?
Y: overall_rating
X: type_traveller , cabin_flown, aircraft   

Hypothesis: we expect business to have a higher rating and will use the correlation between overall rating and cabin flown to validate our hypothesis. 

Do airlines improve their ratings with a particular reviewer over time, if so in which category are the improvements made
Y: overall_rating, other variables TBD after the most significant contributor is found 
X: author, date, airline_name 

Do positive reviews on an airline and positive reviews on lounge and seat have a correlation?
Y: a graph showing correlation 
X: overall_rating (in seat and lounge data set )

Hypothesis: we expect seat rating to have a stronger correlation than the lounge rating because not everyone uses the lounge. 

***Question to the instructor: Is it possible to segment the reviews into “positive” and “negative” ones (using text analysis on the content column) and replace all the positive and negative reviews with the words “good” or “bad”?***
